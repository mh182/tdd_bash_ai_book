#!/usr/bin/env bash

# data_download - A script to download data from various sources.

set -euo pipefail

# Global constants
SCRIPT_NAME=$(basename "$0")

# Global variables (initially empty)
URL=""
DIRECTORY="$(pwd)"  # Default to the current working directory

# Function to print error messages to STDERR
err() {
    echo "$@" >&2
}

# Usage function to show how to use the script
usage() {
    err "Usage: $SCRIPT_NAME URL [-d DIRECTORY]"
    err "Try '$SCRIPT_NAME --help' for more information."
    exit 1
}

# Function to parse command line arguments and set global variables
parse_args() {
    if [[ $# -lt 1 ]]; then
        err "$SCRIPT_NAME: missing argument"
        usage
    fi

    URL="$1"
    shift

    while getopts ":d:" opt; do
        case $opt in
            d) DIRECTORY="$OPTARG" ;;
            *) usage ;;
        esac
    done

    # Set global variables as read-only
    readonly URL
    readonly DIRECTORY
}

# Function to download the data
download_data() {
    echo "Downloading data from $URL to $DIRECTORY"
    wget -P "${DIRECTORY}" "${URL}"
}

# Main function
main() {
    parse_args "$@"
    download_data
}

# Call the main function
main "$@"

